<!DOCTYPE html>
<html>
  <head>
    <title>Kubernetes for Aztek</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif);
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body {
        font-family: 'Droid Serif';
      }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: 400;
        margin-bottom: 0;
      }
      .remark-slide-content h1 { font-size: 3em; }
      .remark-slide-content h2 { font-size: 2em; }
      .remark-slide-content h3 { font-size: 1.6em; }
      .footnote {
        position: absolute;
        bottom: 3em;
      }
      li, p { line-height: 1.618em; }
      .red { color: #fa0000; }
      .gray { color: #cccccc; }
      .large { font-size: 2em; }
      a, a > code {
        color: rgb(249, 38, 114);
        text-decoration: none;
      }
      code {
        background: #e7e8e2;
        border-radius: 5px;
      }
      .remark-code, .remark-inline-code { 
        font-family: 'Ubuntu Mono'; 
        line-height: 1.25em;
      }
      .remark-code-line-highlighted {
         background-color: #373832; 
      }
      .pull-left {
        float: left;
        width: 47%;
      }
      .pull-right {
        float: right;
        width: 47%;
      }
      .pull-right ~ p {
        clear: both;
      }
      #slideshow .slide .content code {
        font-size: 0.8em;
      }
      #slideshow .slide .content pre code {
        font-size: 0.9em;
        padding: 15px;
      }
      .inverse {
        background: #272822;
        color: #777872;
        text-shadow: 0 0 20px #333;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 1.618em;
      }

      /* Slide-specific styling */
      #slide-inverse .footnote {
        bottom: 12px;
        left: 20px;
      }
      #slide-how .slides {
        font-size: 0.9em;
        position: absolute;
        top:  151px;
        right: 140px;
      }
      #slide-how .slides h3 {
        margin-top: 0.2em;
      }
      #slide-how .slides .first, #slide-how .slides .second {
        padding: 1px 20px;
        height: 90px;
        width: 120px;
        -moz-box-shadow: 0 0 10px #777;
        -webkit-box-shadow: 0 0 10px #777;
        box-shadow: 0 0 10px #777;
      }
      #slide-how .slides .first {
        background: #fff;
        position: absolute;
        top: 20%;
        left: 20%;
        z-index: 1;
      }
      #slide-how .slides .second {
        position: relative;
        background: #fff;
        z-index: 0;
      }

      /* Two-column layout */
      .left-column {
        color: #777;
        width: 20%;
        height: 92%;
        float: left;
      }
        .left-column h2:last-of-type, .left-column h3:last-child {
          color: #000;
        }
      .right-column {
        width: 75%;
        float: right;
        padding-top: 1em;
      }

      img {
        max-width: 100%;
        max-height: 450px;
      }

      .icon > img {
        width: 43px;
        height: 43px;
      }

      pre {
        white-space: pre-wrap; 
      }

      @page {
        size: 908px 681px;
        margin: 0;
      }

      svg {
        height: 100%;
      }

      @media print {
        .remark-slide-scaler {
          width: 100% !important;
          height: 100% !important;
          transform: scale(1) !important;
          top: 0 !important;
          left: 0 !important;
        }
      }
    </style>
  </head>
  <body>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse

---

# Kubernetes for Aztek
## Når Docker ikke er nok
Utgave: 15. desember 2020

???
Tittel: Kubernetes for .NET utviklere - Når Docker ikke er nok

Abstrakt:
Kubernetes er et kjøremiljø for kontainere. Mens Docker lar oss bygge og kjøre kontainere på en enkelt maskin, tar Kubernetes denne tankegangen mange skritt videre og orkesterer livsløpet til alle kontainerne våre i et distribuert cluster av noder. Kubernetes gir oss skalerbarhet og høy oppetid og lar oss utføre rullerende oppgraderinger av applikasjonene våre uten nedetid. Det finnes flere alternative kjøremiljø for kontainere, men Kubernetes prefereres av flere skyleverandører, inkludert Azure med sin nye Azure Container Service (AKS).

Advarsel: Dette foredraget er skrevet basert på akkurat nok kompetanse for å kjøre kode i kontainere i et distribuert kjøremiljø.

Kontainere skal tilsynelatende løse alle dev ops utfordringer, og Kubernetes gir svar på mange utfordringer, men fortsatt er det et stykke å gå før vi når Nirvana. Foredraget gir uansett mange tips for hva en .NET utvikler må tenke på for å ta skrittet fra kontainere på utviklermaskin til kontainere i et distribuert produskjonsmiljø.


---

layout: true
class: center, middle

---

layout: false

# Innhold

1. Hva er en kontainer
1. Hva er Kubernetes
1. Hosting
1. Kubectl
1. Når Kubernetes ikke er nok
1. Oppsummering

---

class: center, middle, inverse

# Hva er en kontainer

---

# Kontainere, OS og infrastruktur

![Kontainer host på toppen av operativsystem og infrastruktur](./images/container-on-os-and-infrastructure.png)

Kilde [What is Docker?](https://docs.microsoft.com/en-us/dotnet/standard/microservices-architecture/container-docker-introduction/docker-defined)

???

Linux vs. Windows
Docker container host vs. Hyper-V container host

---

# Docker terminologi

![Docker taksonomi](./images/taxonomy-in-docker.png)

Kilde [Docker containers, images, and registries](https://docs.microsoft.com/en-us/dotnet/standard/microservices-architecture/container-docker-introduction/docker-containers-images-registries)

???
Tag

---

class: center, middle, inverse

# Hva er Kubernetes

---

# Kubernetes er en kontainer orkestrator

![](./images/microservises-in-kubernetes.svg)

Kilde: [Designing, building, and operating microservices on Azure](https://azure.microsoft.com/en-us/blog/microservices-on-azure-kubernetes-guidance/)

---

class: center, middle, inverse

# Hvorfor?

---

# Hvorfor kontainere og Kubernetes?

- Konsistent kjøremiljø
  - slutt på unnskyldningen "It works on my machine"
  - repeterbar
- Isolasjon av applikasjon med avhengigheter
  - forenklet versjonering
  - kontinuerlig utrulling
- Lite overhead
  - høy utnyttelse av maskinvare
  - rask oppstart
  - velegnet for skalering
- Multi- og hybrid sky

---

# Hvorfor ikke kontainere og Kubernetes?

- Kompleksitet
- Trenger kompetanse på både utvikling og infrastruktur
- Forutsetter automasjon
- Forutsetter logging og innsikt
- Enda viktigere å tenke på håndtering av tilstand
- Lengre kode - bygging - debugging syklus
- Ikke alle løsningsarkitekturer er egnet for kontainere
- Vær forberedt på kontinuerlig oppdatering og evaluering av nye muligheter

---

class: center, middle, inverse

# Hva er Kubernetes

---

# Kubernetes konsepter

* Maskiner i kluster
  * Control plane: API, manager og scheduler
  * Workers: Kubelet og proxy
* Objekter:
    * Deployment
    * Pod
    * Volume
    * Service
    * Replica set
    * Job
    * ...
* Navn
* Probes

---

# Control plane og workers

![Using Minikube to Create a Cluster](./images/module_01_cluster.svg)

Kilde: [Using Minikube to Create a Cluster](https://kubernetes.io/docs/tutorials/kubernetes-basics/cluster-intro/)

---

# Deployment

![Using kubectl to Create a Deployment](./images/module_02_first_app.svg)

Kilde: [Using kubectl to Create a Deployment](https://kubernetes.io/docs/tutorials/kubernetes-basics/deploy-intro/)

---

# Pod og volume

![Viewing Pods and Nodes](./images/module_03_nodes.svg)

Kilde: [Viewing Pods and Nodes](https://kubernetes.io/docs/tutorials/kubernetes-basics/explore-intro/)

---

# Service

![Using a Service to Expose Your App](./images/module_04_services.svg)

Kilde: [Using a Service to Expose Your App](https://kubernetes.io/docs/tutorials/kubernetes-basics/expose-intro/)

---

# Replica Set

* Skalering
* Oppgradering

---

# Skalering

![Running Multiple Instances of Your App](./images/module_05_scaling1.svg)

Kilde: [Running Multiple Instances of Your App](https://kubernetes.io/docs/tutorials/kubernetes-basics/scale-intro/)

---

# Skalering

![Running Multiple Instances of Your App](./images/module_05_scaling2.svg)

Kilde: [Running Multiple Instances of Your App](https://kubernetes.io/docs/tutorials/kubernetes-basics/scale-intro/)

---

# Oppgradering

![Performing a Rolling Update](./images/module_06_rollingupdates1.svg)

Kilde: [Performing a Rolling Update](https://kubernetes.io/docs/tutorials/kubernetes-basics/update-intro/)

---

# Oppgradering

![Performing a Rolling Update](./images/module_06_rollingupdates2.svg)

Kilde: [Performing a Rolling Update](https://kubernetes.io/docs/tutorials/kubernetes-basics/update-intro/)

---

# Oppgradering

![Performing a Rolling Update](./images/module_06_rollingupdates3.svg)

Kilde: [Performing a Rolling Update](https://kubernetes.io/docs/tutorials/kubernetes-basics/update-intro/)

---

# Oppgradering

![Performing a Rolling Update](./images/module_06_rollingupdates4.svg)

Kilde: [Performing a Rolling Update](https://kubernetes.io/docs/tutorials/kubernetes-basics/update-intro/)

---

# Job

* Batchjobber
* Kalenderjobber

---

class: inverse

# Navn

_There are only two hard things in Computer Science: cache invalidation and naming things._

_-- Phil Karlton_

---

# Navn

* Namespace: Definerer scope for navn på objekter
* Tag: Merke på kontainer image
* Label: nøkkel og verdi på et Kubernetes objekt
* Selector: Regel for valg av Kubernetes objekt

---

# Probes

* Liveness
* Readiness

---

# Yaml: Deklarasjon av objekter

``` yaml
apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.7.9
        ports:
        - containerPort: 80

```

---

# Hosting / distribusjoner

* Utvikling
    * Kind
    * Minikube
* On-premises
    * Kube Spray
    * CoreOS Tectonic
* Cloud
    * Google Container Engine (GKE)
    * Azure Container Services (AKS)
    * Amazon Elastic Container Service (EKS)
    * Red Hat OpenShift
    * CoreOS Tectonic

---

# Hosting / distribusjoner

* Utvikling
    * **Kind**
    * Minikube
* On-premises
    * Kube Spray
    * CoreOS Tectonic
* Cloud
    * Google Container Engine (GKE)
    * **Azure Container Services (AKS)**
    * Amazon Elastic Container Service (EKS)
    * Red Hat OpenShift
    * CoreOS Tectonic

---

# Kind

* Kjører som Docker containere
* Består av et kluster med en control plane container og en eller flere worker containere

<div class="mermaid">
flowchart
  subgraph Windows
    subgraph Docker
      subgraph Kind
        CP(Control plane)
        CP --> W1(Worker 1)
        CP --> W2(Worker 2)
        CP --> W3(Worker 3)
      end

      subgraph Lagring
        W2  --> V2(Volumes)
        W3  --> V3(Volumes)

        I(Images) 
      end
    end
    
    subgraph WSL2
      L(Linux kjerne) --> LF(Linux filsystem)
    end

    Docker -- Kjører på--> WSL2
  
    WF(Windows filsystem)
  end

  
  classDef container fill:#9fe;
  classDef linux fill:#fe9;

  class CP,W1,W2,W3 container
  class L linux
  
</div>

---

# Azure Container Services (AKS)

* Microsoft har ansvaret for control plane og helsetilstanden til klusteret
* Automatisert oppdatering av Kubernetes
* Fleksibel skalering
* Vi betaler kun for bruk av noder
* Images lagres typisk i Azure Container Registry
* Azure Disk og Azure File Storage kan mountes som volumes

---

# Kubectl

- Kommandolinje verktøy for å administrere Kubernetes
- Valg av kontekst styrer hvilket Kubernetes kluster du går mot

---

# Kubectl: Inspeksjon

``` sh 
kubectl config set-context <name>
```

``` sh
kubectl cluster-info
```

``` sh
kubectl get all
```

``` sh
kubectl describe pods/<pod-name> 
```

---

# Kubectl: Administrasjon

``` sh
kubectl apply -f <file.yaml>
```

``` sh
kubectl exec -ti <pod-name> /bin/bash
```

``` sh
kubectl logs <pod-name>
```

---

class: center, middle, inverse

# Når Kubernetes ikke er nok
# Vi har bare så vidt skrapt i overflaten...

---

# Alternativer

* Docker Swarm
* Apache Mesos
* Mesosphere DCOS
* Marathon
* Nomad
* Azure Service Fabric
* EC2 Container Service (ECS)

---

# Mer enn HelloWorld deployment

* Kubernetes' deklarative yaml filer er primitive og uten variasjoner
* Helm
  * Parametriserte charts
* [Spinnaker](https://www.spinnaker.io/)
  * Netflix prosjekt
  * Multi-sky deployments

---

# Overvåking

* Kubernetes har kun primitiv innebygd overvåkning
* Klusterovervåking
  * [Prometheus](https://prometheus.io/)
  * [Heapster](https://github.com/kubernetes/heapster)
  * [Grafana](https://grafana.com/)
  * [cAdvisor](https://github.com/google/cadvisor)
* Applikasjonsovervåkning
  * Kubernetes probes
  * Application Insights
  * Azure Container Monitoring Solution
 
---

# Service Mesh

* [Istio](https://istio.io/)
* [Dapr](https://dapr.io/)
* [Linkerd](https://linkerd.io/)

---

# Utfordringer

* Kubernetes er i stadig utvikling, og enkelte ganger kan det væer lurt å vente på vNext
* Kubernetes 1.8 (september 2017)
  * CronJobs er i beta
* Kubernetes 1.9 (desember 2017)
  * Windows containere er i beta
  * IP v6 er i alpha
  * Tildeling av GPU ressurser er i aplpha
* Kubernetes vNext
  * ???

---

class: center, middle, inverse

# Oppsummering

---

# Oppsummering

* Docker er ikke nok - Kubernetes er orkestratoren som er en de-facto standard
* Docker image > i en kontainer > i en pod sammen med volume > deployes på en eller flere noder > som nås via en service

* Kom i gang lokalt med kind
* Velg administrert hosting i skyen

---

# Veien videre

* Tutorial: [Kubernetes Basics Tutorial](https://kubernetes.io/docs/tutorials/kubernetes-basics/)
* Tutorial: [Azure Container Service (AKS)](https://docs.microsoft.com/en-us/azure/aks/tutorial-kubernetes-prepare-app)
* Pluralhsight kurs: [Getting Started with Kubernetes](https://app.pluralsight.com/library/courses/getting-started-kubernetes/table-of-contents)
* E-bok: [.NET Microservices. Architecture for Containerized .NET Applications](https://docs.microsoft.com/en-us/dotnet/standard/microservices-architecture/)

---

class: center, middle, inverse

# Spørsmål ?

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
      var slideshow = remark.create();
      mermaid.initialize({startOnLoad:true});
    </script>
  </body>
</html>